{% extends 'base.html' %}

{% block title %}Inscription au Congrès SFT 2026{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white text-center">
                    <h2><i class="fas fa-user-check me-2"></i>Inscription au Congrès SFT 2026</h2>
                    <p class="mb-0">Société Française de Thermique - Nancy, 1-3 juin 2026</p>
                </div>
                
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Information :</strong> Les champs marqués d'un astérisque (<span class="required">*</span>) sont obligatoires. 
                        Un récapitulatif JSON de votre inscription vous sera envoyé par email.
                    </div>
                    
                    <form method="POST" enctype="multipart/form-data" id="registrationForm">
                        <!-- Section 1: Informations personnelles -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-user me-2"></i>1. Informations personnelles
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="title" class="form-label">Titre</label>
                                        <select class="form-select" name="title" id="title">
                                            <option value="">--</option>
                                            <option value="M.">M.</option>
                                            <option value="Mme">Mme</option>
                                            <option value="Dr.">Dr.</option>
                                            <option value="Pr.">Pr.</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-5">
                                    <div class="mb-3">
                                        <label for="first_name" class="form-label">Prénom <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="first_name" id="first_name" required>
                                    </div>
                                </div>
                                
                                <div class="col-md-5">
                                    <div class="mb-3">
                                        <label for="last_name" class="form-label">Nom <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="last_name" id="last_name" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email <span class="required">*</span></label>
                                        <input type="email" class="form-control" name="email" id="email" required>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="phone" class="form-label">Téléphone</label>
                                        <input type="tel" class="form-control" name="phone" id="phone">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section 2: Affiliation professionnelle -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-building me-2"></i>2. Affiliation professionnelle
                            </h4>
                            
                            <div class="mb-3">
                                <label for="institution" class="form-label">Institution / Entreprise <span class="required">*</span></label>
                                <input type="text" class="form-control" name="institution" id="institution" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="department" class="form-label">Département / Laboratoire</label>
                                        <input type="text" class="form-control" name="department" id="department">
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="position" class="form-label">Fonction / Poste</label>
                                        <input type="text" class="form-control" name="position" id="position" 
                                               placeholder="Ex: Doctorant, Ingénieur, Professeur...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section 3: Adresse -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-map-marker-alt me-2"></i>3. Adresse
                            </h4>
                            
                            <div class="mb-3">
                                <label for="address" class="form-label">Adresse complète</label>
                                <textarea class="form-control" name="address" id="address" rows="2"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="city" class="form-label">Ville</label>
                                        <input type="text" class="form-control" name="city" id="city">
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="postal_code" class="form-label">Code postal</label>
                                        <input type="text" class="form-control" name="postal_code" id="postal_code">
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="country" class="form-label">Pays</label>
                                        <input type="text" class="form-control" name="country" id="country" value="France">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section 4: Type de participation -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-users me-2"></i>4. Type de participation <span class="required">*</span>
                            </h4>
                            
                            <div class="row">
                                {% for value, label in participant_types %}
                                <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input participant-type" type="radio" name="participant_type" 
                                               id="{{ value }}" value="{{ value }}" required>
                                        <label class="form-check-label" for="{{ value }}">
                                            <strong>{{ label }}</strong>
                                            <br><small class="text-muted">
                                                {% if value == 'auteur' %}Tarif : 350€
                                                {% elif value == 'auditeur' %}Tarif : 300€
                                                {% elif value == 'etudiant' %}Tarif : 100€ (justificatif requis)
                                                {% elif value == 'accompagnant' %}Tarif : 150€
                                                {% elif value == 'industriel' %}Tarif : 450€
                                                {% endif %}
                                            </small>
                                        </label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Justificatif étudiant -->
                            <div id="student-proof" class="mt-3" style="display: none;">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Justificatif étudiant requis :</strong> Veuillez joindre un certificat de scolarité récent.
                                </div>
                                <input type="file" class="form-control" name="student_proof" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                        </div>
                        
                        <!-- Section 5: Programme et options -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-calendar me-2"></i>5. Programme et options
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Jours de présence :</h6>
                                    <div class="form-check">
                                        <input class="form-check-input attendance-day" type="checkbox" name="day1" id="day1" checked>
                                        <label class="form-check-label" for="day1">Mercredi 1er juin 2026</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input attendance-day" type="checkbox" name="day2" id="day2" checked>
                                        <label class="form-check-label" for="day2">Jeudi 2 juin 2026</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input attendance-day" type="checkbox" name="day3" id="day3" checked>
                                        <label class="form-check-label" for="day3">Vendredi 3 juin 2026</label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6>Options repas (25€/repas) :</h6>
                                    <div class="form-check">
                                        <input class="form-check-input lunch-option" type="checkbox" name="lunch_day1" id="lunch_day1">
                                        <label class="form-check-label" for="lunch_day1">Déjeuner mercredi (+25€)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input lunch-option" type="checkbox" name="lunch_day2" id="lunch_day2">
                                        <label class="form-check-label" for="lunch_day2">Déjeuner jeudi (+25€)</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input lunch-option" type="checkbox" name="lunch_day3" id="lunch_day3">
                                        <label class="form-check-label" for="lunch_day3">Déjeuner vendredi (+25€)</label>
                                    </div>
                                </div>
                            </div>
                            
                            <hr>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input gala-option" type="checkbox" name="poster_session" id="poster_session">
                                        <label class="form-check-label" for="poster_session">
                                            <strong>Participation session posters</strong>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input gala-option" type="checkbox" name="gala_dinner" id="gala_dinner">
                                        <label class="form-check-label" for="gala_dinner">
                                            <strong>Dîner de gala (+60€)</strong>
                                            <br><small class="text-muted">Jeudi 2 juin au soir</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section 6: Hébergement -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-bed me-2"></i>6. Hébergement
                            </h4>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="accommodation_needed" id="accommodation_needed">
                                <label class="form-check-label" for="accommodation_needed">
                                    <strong>J'ai besoin d'aide pour l'hébergement</strong>
                                </label>
                            </div>
                            
                            <div id="accommodation-details" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="accommodation_type" class="form-label">Type d'hébergement souhaité</label>
                                            <select class="form-select" name="accommodation_type" id="accommodation_type">
                                                <option value="">Choisir...</option>
                                                {% for value, label in accommodation_types %}
                                                <option value="{{ value }}">{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="accommodation_start" class="form-label">Arrivée</label>
                                            <input type="date" class="form-control" name="accommodation_start" id="accommodation_start" 
                                                   value="2026-05-31">
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="accommodation_end" class="form-label">Départ</label>
                                            <input type="date" class="form-control" name="accommodation_end" id="accommodation_end" 
                                                   value="2026-06-04">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section 7: Besoins spéciaux -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-heart me-2"></i>7. Besoins spéciaux et régimes alimentaires
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="dietary_requirements" class="form-label">Régime alimentaire</label>
                                        <textarea class="form-control" name="dietary_requirements" id="dietary_requirements" rows="3"
                                                  placeholder="Ex: végétarien, allergies alimentaires..."></textarea>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="accessibility_needs" class="form-label">Besoins d'accessibilité</label>
                                        <textarea class="form-control" name="accessibility_needs" id="accessibility_needs" rows="3"
                                                  placeholder="Ex: fauteuil roulant, déficience auditive..."></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="special_requests" class="form-label">Demandes particulières</label>
                                <textarea class="form-control" name="special_requests" id="special_requests" rows="2"
                                          placeholder="Autres demandes spécifiques..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Section 8: Facturation -->
                        <div class="form-section">
                            <h4 class="section-header">
                                <i class="fas fa-receipt me-2"></i>8. Informations de facturation
                            </h4>
                            
                            <div class="mb-3">
                                <label for="billing_name" class="form-label">Nom pour la facturation</label>
                                <input type="text" class="form-control" name="billing_name" id="billing_name"
                                       placeholder="Si différent du nom du participant">
                            </div>
                            
                            <div class="mb-3">
                                <label for="billing_address" class="form-label">Adresse de facturation</label>
                                <textarea class="form-control" name="billing_address" id="billing_address" rows="3"
                                          placeholder="Si différente de l'adresse personnelle"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="billing_vat" class="form-label">Numéro de TVA</label>
                                        <input type="text" class="form-control" name="billing_vat" id="billing_vat">
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="purchase_order" class="form-label">Bon de commande</label>
                                        <input type="text" class="form-control" name="purchase_order" id="purchase_order">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Récapitulatif des coûts -->
                        <div class="pricing-info">
                            <h5><i class="fas fa-calculator me-2"></i>Récapitulatif des coûts</h5>
                            <div id="cost-breakdown">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div id="cost-details">
                                            <p>Sélectionnez un type de participant pour voir les tarifs</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <div class="total-amount">
                                            Total : <span id="total-amount">0</span>€
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Validation et soumission -->
                        <div class="form-section">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="accept_terms" required>
                                <label class="form-check-label" for="accept_terms">
                                    <strong>J'accepte les conditions générales <span class="required">*</span></strong>
                                    <br><small class="text-muted">
                                        En cochant cette case, j'accepte que mes données soient traitées conformément 
                                        au RGPD et utilisées pour l'organisation de l'événement.
                                    </small>
                                </label>
                            </div>
                            
                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="newsletter">
                                <label class="form-check-label" for="newsletter">
                                    J'accepte de recevoir les communications de la SFT
                                </label>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-paper-plane me-2"></i>
                                    Envoyer mon inscription
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tarifs de base
    const basePrices = {
        'auteur': 350,
        'auditeur': 300,
        'etudiant': 100,
        'accompagnant': 150,
        'industriel': 450
    };
    
    // Gestion du type de participant
    document.querySelectorAll('.participant-type').forEach(radio => {
        radio.addEventListener('change', function() {
            const studentProof = document.getElementById('student-proof');
            if (this.value === 'etudiant') {
                studentProof.style.display = 'block';
            } else {
                studentProof.style.display = 'none';
            }
            updateCosts();
        });
    });
    
    // Gestion de l'hébergement
    document.getElementById('accommodation_needed').addEventListener('change', function() {
        const details = document.getElementById('accommodation-details');
        details.style.display = this.checked ? 'block' : 'none';
    });
    
    // Gestion des coûts
    function updateCosts() {
        const participantType = document.querySelector('input[name="participant_type"]:checked');
        const lunchOptions = document.querySelectorAll('.lunch-option:checked');
        const galaDinner = document.getElementById('gala_dinner').checked;
        
        let total = 0;
        let details = '';
        
        if (participantType) {
            const basePrice = basePrices[participantType.value];
            total += basePrice;
            details += `<p>Inscription ${participantType.value} : ${basePrice}€</p>`;
        }
        
        if (lunchOptions.length > 0) {
            const lunchCost = lunchOptions.length * 25;
            total += lunchCost;
            details += `<p>Repas (${lunchOptions.length}) : ${lunchCost}€</p>`;
        }
        
        if (galaDinner) {
            total += 60;
            details += `<p>Dîner de gala : 60€</p>`;
        }
        
        document.getElementById('cost-details').innerHTML = details || '<p>Sélectionnez vos options</p>';
        document.getElementById('total-amount').textContent = total;
    }
    
    // Écouter tous les changements qui affectent le prix
    document.querySelectorAll('.lunch-option, .gala-option').forEach(checkbox => {
        checkbox.addEventListener('change', updateCosts);
    });
    
    // Auto-remplir les champs si utilisateur connecté
    {% if current_user.is_authenticated %}
    document.getElementById('first_name').value = '{{ current_user.first_name or "" }}';
    document.getElementById('last_name').value = '{{ current_user.last_name or "" }}';
    document.getElementById('email').value = '{{ current_user.email or "" }}';
    {% endif %}
});
</script>
{% endblock %}
