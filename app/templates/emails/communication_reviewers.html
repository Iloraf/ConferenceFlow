<!-- templates/emails/communication_reviewers.html -->
{% extends 'emails/base_email.html' %}

{% block title %}{{ email_subject }}{% endblock %}

{% block header_title %}Review SFT 2026{% endblock %}
{% block header_subtitle %}{{ communication.title }}{% endblock %}

{% block content %}
<p>Bonjour <strong>{{ reviewer.first_name or reviewer.email.split('@')[0] }}</strong>,</p>

<p>{{ email_content|safe|replace('[PRENOM]', reviewer.first_name or '')|replace('[NOM]', reviewer.last_name or '')|replace('[TITRE_COMMUNICATION]', communication.title)|replace('[ID_COMMUNICATION]', communication.id|string) }}</p>

<div class="communication-box">
    <div class="communication-title">{{ communication.title }}</div>
    
    <p><strong>ID :</strong> {{ communication.id }}</p>
    <p><strong>Type :</strong> {{ communication.type.title() }}</p>
    
    {% if communication.authors %}
    <p><strong>Auteur(s) :</strong> 
        {% for author in communication.authors %}
            {{ author.first_name }} {{ author.last_name }}
            {% if author.affiliations %}
                ({% for affiliation in author.affiliations %}{{ affiliation.sigle }}{% if not loop.last %}, {% endif %}{% endfor %})
            {% endif %}
            {% if not loop.last %}, {% endif %}
        {% endfor %}
    </p>
    {% endif %}
    
    {% if communication.thematiques %}
    <div class="thematiques">
        <strong>Th√©matiques :</strong><br>
        {% for thematique in communication.thematiques %}
        <span class="thematique-badge" style="background-color: {{ thematique.couleur }};">
            {{ thematique.code }} - {{ thematique.nom }}
        </span>
        {% endfor %}
    </div>
    {% endif %}
</div>

{% set review = communication.reviews|selectattr('reviewer_id', 'equalto', reviewer.id)|first %}
{% if review %}
    {% if review.completed %}
    <div class="alert alert-success">
        <strong>‚úÖ Review termin√©e</strong><br>
        <small>Merci pour votre √©valuation effectu√©e le {{ review.submitted_at.strftime('%d/%m/%Y') }}</small>
    </div>
    {% else %}
    <div class="alert alert-warning">
        <strong>‚è≥ Review en cours</strong><br>
        <small>Votre √©valuation est en attente</small>
    </div>
    {% endif %}
    
    {% set assignment = review.assignment %}
    {% if assignment and assignment.due_date %}
    <div class="alert alert-info">
        <strong>üìÖ √âch√©ance :</strong> {{ assignment.due_date.strftime('%d/%m/%Y') }}<br>
        {% if assignment.is_overdue %}
            <small style="color: #dc3545;"><strong>‚ö†Ô∏è √âch√©ance d√©pass√©e</strong></small>
        {% else %}
            <small>Merci de rendre votre √©valuation avant cette date</small>
        {% endif %}
    </div>
    {% endif %}
{% endif %}

<p><strong>Actions reviewer :</strong></p>
<ul>
    <li>Consultez la communication compl√®te</li>
    <li>V√©rifiez l'absence de conflit d'int√©r√™t</li>
    <li>R√©alisez votre √©valuation</li>
    <li>Soumettez votre rapport et recommandation</li>
</ul>

<div style="text-align: center; margin: 30px 0;">
    <a href="{{ url_for('main.reviewer_dashboard', _external=True) }}" class="btn">
        üìä Mon tableau de bord reviewer
    </a>
    {% if review and not review.completed %}
    <a href="{{ url_for('main.submit_review', comm_id=communication.id, _external=True) }}" class="btn btn-secondary">
        üìù Effectuer la review
    </a>
    {% endif %}
</div>

<p>Merci pour votre engagement et votre expertise au service de la communaut√© scientifique !</p>

<p>Pour toute question, contactez-nous √† 
<a href="mailto:congres-sft2026@univ-lorraine.fr" style="color: #007bff;">congres-sft2026@univ-lorraine.fr</a></p>

<p>Cordialement,<br>
<strong>L'√©quipe d'organisation SFT 2026</strong></p>
{% endblock %}
