<!-- templates/emails/bulk_email.html -->
{% extends 'emails/base_emails.html' %}

{% block title %}{{ email_subject }}{% endblock %}

{% block header_title %}{{ CONFERENCE_SHORT_NAME | default('Conference Flow') }}{% endblock %}
{% block header_subtitle %}{{ email_subject }}{% endblock %}

{% block content %}
<p>Bonjour <strong>{{ recipient.first_name or recipient.email.split('@')[0] }}</strong>,</p>

<p>{{ email_content|safe|replace('[PRENOM]', recipient.first_name or '')|replace('[NOM]', recipient.last_name or '') }}</p>

{% if communications %}
<div class="communication-box">
    <strong>Communication(s) concernée(s) :</strong>
    {% for communication in communications %}
    <div style="margin: 10px 0; padding: 10px; border-left: 3px solid #007bff; background-color: #f8f9fa;">
        <div class="communication-title">{{ communication.title }}</div>
        <p><strong>ID :</strong> {{ communication.id }} | <strong>Type :</strong> {{ communication.type.title() }}</p>

	{% if communication.thematiques %}
	<div class="thematiques">
	  <strong>Thématiques :</strong>
	  <span style="color: #007bff;">
            {% if communication.thematiques is iterable and communication.thematiques is not string %}
            {# C'est déjà une liste d'objets #}
            {% for theme in communication.thematiques %}
            {{ theme.nom if theme.nom else theme.code }}{% if not loop.last %}, {% endif %}
            {% endfor %}
            {% else %}
            {# C'est une chaîne de codes #}
            {{ communication.thematiques | convert_theme_codes }}
            {% endif %}
	  </span>
	</div>
	{% endif %}
	
    </div>
    {% endfor %}
</div>
{% endif %}

<div style="text-align: center; margin: 30px 0;">
  {% if recipient.is_reviewer %}
  <a href="{{ url_for('main.reviewer_dashboard', _external=True) }}" class="btn">
        Mon tableau de bord reviewer
    </a>
    {% else %}
    <a href="{{ url_for('main.mes_communications', _external=True) }}" class="btn">
        Mes communications
    </a>
    {% endif %}
</div>

<p>Pour toute question, n'hésitez pas à nous contacter à 
<a href="mailto:{{ CONFERENCE_EMAIL | default('contact@conference.fr') }}" style="color: #007bff;">{{ CONFERENCE_EMAIL | default('contact@conference.fr') }}</a></p>

<p>Cordialement,<br>
<strong>L'équipe d'organisation {{ CONFERENCE_SHORT_NAME | default('Conference Flow') }}</strong></p>
{% endblock %}
